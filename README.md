<!-- Code generated by gomarkdoc. DO NOT EDIT -->

[![GitHub Actions](https://github.com/nomadops/driftctl-slack/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/nomadops/driftctl-slack/actions/workflows/ci.yml)

driftctl-slack is a golang wrapper to send driftctl scan summary to slack.

We've provided a [Terraform module](https://github.com/nomadops/terraform-aws-driftctl-slack) for deployment as a scheduleds ECS Fargate task. 
`driftctl-slack` will execute driftctl-scan, send a summary of the report to a slack channel and then copy the report to a S3 bucket.

`driftctl scan` will be executed as the following command:

```bash
$ /usr/local/bin/driftctl scan --quiet --from tfstate+s3://"${STATE_BUCKET}"/**/*.tfstate -o json://"${DRIFTCTL_JSON}"
````

Usage:

`driftctl-slack` requires three environment variables to bet set: `SCAN_BUCKET`, `STATE_BUCKET`, `TOKEN` and `CHANNEL`
```bash
$ export SCAN_BUCKET=my-scan-bucket \
  STATE_BUCKET=my-tf-state-bucket \
  TOKEN=my-slack-token \
  CHANNEL="#gitops"
$ driftctl-slack
```

Output is sent to stdout in json format for easy log processing. 

```json
{"level":"info","service":"driftctl","time":"2021-12-27T14:49:17Z"}
{"level":"info","service":"driftctl","time":"2021-12-27T14:49:17Z","message":"Driftctl scan detected drift."}
{"level":"info","service":"driftctl","time":"2021-12-27T14:49:17Z"}
{"level":"info","service":"driftctl-slack","channel":"#gitops","time":"2021-12-27T14:49:17Z","message":"Message successfully sent to slack."}
{"level":"info","service":"driftctl-slack","total_resources":428,"total_changed":0,"total_unmanaged":307,"total_missing":7,"total_managed":114,"time":"2021-12-27T14:49:17Z","message":"Driftctl scan summary"}
{"level":"info","service":"driftctl-slack","VersionId":"2AgtP5l6bRYGW30DJtT_89K_GueXeW7m","time":"2021-12-27T14:49:18Z","message":"Report uploaded to S3"}
```

driftctl-slack is licensed under Apache License 2.0.

# driftctl

```go
import "command-line-arguments"
```

## Index

- [func Run(bucket string, driftctlJSON string) (err error)](<#func-run>)
- [func ScanSummary(report []byte) (map[string]int, error)](<#func-scansummary>)
- [type Scan](<#type-scan>)


## func [Run](<https://github.com/nomadops/driftctl-slack/blob/main/driftctl/driftctl.go#L81>)

```go
func Run(bucket string, driftctlJSON string) (err error)
```

Run executs the driftctl scan command and returns the output as a byte slice\.

## func [ScanSummary](<https://github.com/nomadops/driftctl-slack/blob/main/driftctl/driftctl.go#L65>)

```go
func ScanSummary(report []byte) (map[string]int, error)
```

ScanSummary returns a map\[string\]string of the Summary section from \`driftctl scan \-o json://file\`\.

## type [Scan](<https://github.com/nomadops/driftctl-slack/blob/main/driftctl/driftctl.go#L12-L46>)

Scan struct is the json output of \`driftctl scan\`\.

```go
type Scan struct {
    Alerts struct {
        // contains filtered or unexported fields
    }   `json:"alerts"`
    Coverage    int64       `json:"coverage"`
    Differences interface{} `json:"differences"`
    Managed     []struct {
        ID     string `json:"id"`
        Source struct {
            InternalName string `json:"internal_name"`
            Namespace    string `json:"namespace"`
            Source       string `json:"source"`
        }   `json:"source"`
        Type string `json:"type"`
    }   `json:"managed"`
    Missing []struct {
        ID   string `json:"id"`
        Type string `json:"type"`
    }   `json:"missing"`
    ProviderName    string `json:"provider_name"`
    ProviderVersion string `json:"provider_version"`
    Summary         struct {
        TotalChanged   int64 `json:"total_changed"`
        TotalManaged   int64 `json:"total_managed"`
        TotalMissing   int64 `json:"total_missing"`
        TotalResources int64 `json:"total_resources"`
        TotalUnmanaged int64 `json:"total_unmanaged"`
    }   `json:"summary"`
    Unmanaged []struct {
        ID   string `json:"id"`
        Type string `json:"type"`
    }   `json:"unmanaged"`
}
```

# s3

```go
import "command-line-arguments"
```

## Index

- [func PutFile(c context.Context, api putObjectAPI, input *s3.PutObjectInput) (*s3.PutObjectOutput, error)](<#func-putfile>)


## func [PutFile](<https://github.com/nomadops/driftctl-slack/blob/main/s3/s3.go#L27>)

```go
func PutFile(c context.Context, api putObjectAPI, input *s3.PutObjectInput) (*s3.PutObjectOutput, error)
```

PutFile uploads a file to an Amazon Simple Storage Service \(Amazon S3\) bucket Inputs: c is the context of the method call\, which includes the AWS Region api is the interface that defines the method call input defines the input arguments to the service call\. Output: If success\, a PutObjectOutput object containing the result of the service call and nil Otherwise\, nil and an error from the call to PutObject

# driftslack

```go
import "command-line-arguments"
```

## Index

- [func SendSummary(token string, channel string, message map[string]int) error](<#func-sendsummary>)


## func [SendSummary](<https://github.com/nomadops/driftctl-slack/blob/main/slack/slack.go#L67>)

```go
func SendSummary(token string, channel string, message map[string]int) error
```

SendSummary sends formatted summary to \`\#gitops\` channel\.



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
